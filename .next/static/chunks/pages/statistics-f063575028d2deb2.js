(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[80],{4354:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/statistics",function(){return t(8455)}])},8455:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return l}});var r=t(5893),n=t(7294),a=t(9008),c=t.n(a);function l(){let[e,s]=(0,n.useState)({totalAssessments:0,averageScore:0,statusDistribution:{},loading:!0,error:null});async function t(){try{let e=await fetch("/api/assessments"),t=await e.json();if(!Array.isArray(t))throw Error("Invalid data format");let r=t.length,n=t.reduce((e,s)=>e+(s.totalScore||0),0),a=r>0?(n/r).toFixed(2):0,c=t.reduce((e,s)=>{let t=s.status||"未知";return e[t]=(e[t]||0)+1,e},{});s({totalAssessments:r,averageScore:a,statusDistribution:c,loading:!1,error:null})}catch(e){console.error("Error fetching statistics:",e),s(e=>({...e,loading:!1,error:"獲取數據失敗"}))}}async function a(){let e=document.getElementById("exportButton");e.disabled=!0,e.textContent="匯出中...";try{console.log("開始匯出流程...");let e=await fetch("/api/assessments");if(!e.ok)throw Error("檢查數據時發生錯誤: ".concat(e.status," ").concat(e.statusText));let s=await e.json();if(console.log("找到 ".concat(s.length," 筆評估數據")),!Array.isArray(s)||0===s.length){alert("沒有可匯出的數據");return}console.log("開始下載 CSV...");let t=await fetch("/api/assessments?export=true");if(console.log("Content-Type:",t.headers.get("Content-Type")),console.log("Content-Disposition:",t.headers.get("Content-Disposition")),!t.ok){let e=await t.json();throw Error("匯出失敗: ".concat(e.message||t.statusText))}let r=await t.blob();if(console.log("下載的文件大小:",r.size,"bytes"),0===r.size)throw Error("匯出的文件為空");let n=window.URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download="mna-assessment-report.csv",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(n),document.body.removeChild(a),alert("匯出成功！")}catch(e){console.error("匯出錯誤:",e),alert("匯出失敗: ".concat(e.message))}finally{e.disabled=!1,e.textContent="匯出 Excel"}}return(0,n.useEffect)(()=>{t()},[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(c(),{children:[(0,r.jsx)("title",{children:"MNA 評估統計 - 迷你營養評估表"}),(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,r.jsx)("link",{href:"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css",rel:"stylesheet"})]}),(0,r.jsxs)("div",{className:"container mt-5",children:[(0,r.jsx)("h1",{className:"mb-4",children:"MNA 評估統計"}),e.loading?(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("div",{className:"spinner-border",role:"status",children:(0,r.jsx)("span",{className:"visually-hidden",children:"載入中..."})})}):e.error?(0,r.jsx)("div",{className:"alert alert-danger",children:e.error}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"row",children:[(0,r.jsx)("div",{className:"col-md-6 mb-4",children:(0,r.jsx)("div",{className:"card",children:(0,r.jsxs)("div",{className:"card-body",children:[(0,r.jsx)("h5",{className:"card-title",children:"總評估數"}),(0,r.jsx)("p",{className:"card-text display-4",children:e.totalAssessments})]})})}),(0,r.jsx)("div",{className:"col-md-6 mb-4",children:(0,r.jsx)("div",{className:"card",children:(0,r.jsxs)("div",{className:"card-body",children:[(0,r.jsx)("h5",{className:"card-title",children:"平均分數"}),(0,r.jsx)("p",{className:"card-text display-4",children:e.averageScore})]})})})]}),(0,r.jsx)("div",{className:"card mb-4",children:(0,r.jsxs)("div",{className:"card-body",children:[(0,r.jsx)("h5",{className:"card-title",children:"營養狀況分布"}),(0,r.jsx)("div",{className:"table-responsive",children:(0,r.jsxs)("table",{className:"table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"狀況"}),(0,r.jsx)("th",{children:"人數"}),(0,r.jsx)("th",{children:"百分比"})]})}),(0,r.jsx)("tbody",{children:Object.entries(e.statusDistribution).map(s=>{let[t,n]=s;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:t}),(0,r.jsx)("td",{children:n}),(0,r.jsxs)("td",{children:[(n/e.totalAssessments*100).toFixed(1),"%"]})]},t)})})]})})]})}),(0,r.jsx)("div",{className:"text-center mb-5",children:(0,r.jsx)("button",{id:"exportButton",className:"btn btn-primary",onClick:a,children:"匯出 Excel"})})]})]})]})}},9008:function(e,s,t){e.exports=t(3867)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=4354)}),_N_E=e.O()}]);